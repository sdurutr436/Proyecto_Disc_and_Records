{
  "version": 3,
  "sources": ["src/app/services/loading.ts"],
  "sourcesContent": ["/**\r\n * LoadingService - Gestión de Estados de Carga\r\n *\r\n * PROPÓSITO:\r\n * Servicio centralizado para gestionar estados de carga global y local\r\n * en la aplicación. Permite mostrar/ocultar spinners y barras de progreso.\r\n *\r\n * CARACTERÍSTICAS:\r\n * - Estado de carga global (overlay completo)\r\n * - Estados de carga locales (por identificador)\r\n * - Contador de operaciones simultáneas\r\n * - Observable para suscripción reactiva\r\n * - Barra de progreso con porcentaje\r\n *\r\n * ARQUITECTURA:\r\n * ┌─────────────────────────────────────────────────────────────┐\r\n * │                    COMPONENTES                               │\r\n * │  (AlbumService, AuthService, HttpInterceptor, etc.)         │\r\n * └──────────────┬──────────────────────────────────────────────┘\r\n *                │ start() / stop()\r\n *                ↓\r\n * ┌─────────────────────────────────────────────────────────────┐\r\n * │                  LoadingService                              │\r\n * │  - isLoading$ (Observable<boolean>)                         │\r\n * │  - progress$ (Observable<number>)                           │\r\n * │  - localStates (Map<string, boolean>)                       │\r\n * └──────────────┬──────────────────────────────────────────────┘\r\n *                │ Signals/Observables\r\n *                ↓\r\n * ┌─────────────────────────────────────────────────────────────┐\r\n * │              UI COMPONENTS                                   │\r\n * │  - Spinner (global overlay)                                  │\r\n * │  - ProgressBar (barra de progreso)                          │\r\n * │  - Button (loading local)                                    │\r\n * └─────────────────────────────────────────────────────────────┘\r\n */\r\n\r\nimport { Injectable, signal, computed } from '@angular/core';\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\n\r\n/**\r\n * Configuración para operaciones de carga\r\n */\r\nexport interface LoadingConfig {\r\n  /** Identificador único para loading local */\r\n  id?: string;\r\n  /** Mensaje a mostrar durante la carga */\r\n  message?: string;\r\n  /** Si es true, bloquea interacción con la UI */\r\n  blocking?: boolean;\r\n}\r\n\r\n/**\r\n * Estado de una operación de carga\r\n */\r\nexport interface LoadingState {\r\n  isLoading: boolean;\r\n  message: string;\r\n  progress: number;\r\n}\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class LoadingService {\r\n  // =========================================================================\r\n  // ESTADO GLOBAL\r\n  // =========================================================================\r\n\r\n  /**\r\n   * Contador de operaciones activas\r\n   * Permite múltiples operaciones simultáneas sin conflictos\r\n   */\r\n  private activeOperations = signal(0);\r\n\r\n  /**\r\n   * Mensaje de carga actual\r\n   */\r\n  private loadingMessage = signal('Cargando...');\r\n\r\n  /**\r\n   * Progreso actual (0-100)\r\n   * -1 indica progreso indeterminado\r\n   */\r\n  private currentProgress = signal(-1);\r\n\r\n  /**\r\n   * Signal computado: indica si hay alguna operación activa\r\n   */\r\n  readonly isLoading = computed(() => this.activeOperations() > 0);\r\n\r\n  /**\r\n   * Signal computado: mensaje actual de carga\r\n   */\r\n  readonly message = computed(() => this.loadingMessage());\r\n\r\n  /**\r\n   * Signal computado: progreso actual\r\n   */\r\n  readonly progress = computed(() => this.currentProgress());\r\n\r\n  // =========================================================================\r\n  // ESTADO LOCAL (Por componente/operación)\r\n  // =========================================================================\r\n\r\n  /**\r\n   * Map de estados locales por ID\r\n   * Permite que botones/componentes tengan su propio estado de carga\r\n   */\r\n  private localStates = new Map<string, boolean>();\r\n\r\n  /**\r\n   * Subject para notificar cambios en estados locales\r\n   */\r\n  private localStatesSubject = new BehaviorSubject<Map<string, boolean>>(\r\n    new Map()\r\n  );\r\n\r\n  /**\r\n   * Observable de estados locales\r\n   */\r\n  readonly localStates$ = this.localStatesSubject.asObservable();\r\n\r\n  // =========================================================================\r\n  // MÉTODOS PÚBLICOS - LOADING GLOBAL\r\n  // =========================================================================\r\n\r\n  /**\r\n   * Inicia una operación de carga global\r\n   *\r\n   * WORKFLOW:\r\n   * 1. Incrementa contador de operaciones\r\n   * 2. Actualiza mensaje si se proporciona\r\n   * 3. UI muestra spinner automáticamente\r\n   *\r\n   * @param message - Mensaje opcional a mostrar\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * loadingService.start('Guardando álbum...');\r\n   * await albumService.save(album);\r\n   * loadingService.stop();\r\n   * ```\r\n   */\r\n  start(message: string = 'Cargando...'): void {\r\n    this.activeOperations.update((count) => count + 1);\r\n    this.loadingMessage.set(message);\r\n    this.currentProgress.set(-1); // Indeterminado\r\n  }\r\n\r\n  /**\r\n   * Detiene una operación de carga global\r\n   *\r\n   * WORKFLOW:\r\n   * 1. Decrementa contador de operaciones\r\n   * 2. Si llega a 0, UI oculta spinner\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * loadingService.stop();\r\n   * ```\r\n   */\r\n  stop(): void {\r\n    this.activeOperations.update((count) => Math.max(0, count - 1));\r\n\r\n    // Si no hay operaciones, resetear estado\r\n    if (this.activeOperations() === 0) {\r\n      this.currentProgress.set(-1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fuerza la detención de todas las operaciones\r\n   * Usar con precaución (por ejemplo, al hacer logout)\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * // Al cerrar sesión\r\n   * loadingService.stopAll();\r\n   * ```\r\n   */\r\n  stopAll(): void {\r\n    this.activeOperations.set(0);\r\n    this.currentProgress.set(-1);\r\n    this.localStates.clear();\r\n    this.localStatesSubject.next(new Map());\r\n  }\r\n\r\n  // =========================================================================\r\n  // MÉTODOS PÚBLICOS - PROGRESO\r\n  // =========================================================================\r\n\r\n  /**\r\n   * Establece el progreso de la operación actual\r\n   *\r\n   * @param percent - Porcentaje de progreso (0-100)\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * loadingService.start('Subiendo archivo...');\r\n   * loadingService.setProgress(25);\r\n   * // ... más operaciones\r\n   * loadingService.setProgress(50);\r\n   * loadingService.setProgress(100);\r\n   * loadingService.stop();\r\n   * ```\r\n   */\r\n  setProgress(percent: number): void {\r\n    this.currentProgress.set(Math.min(100, Math.max(0, percent)));\r\n  }\r\n\r\n  /**\r\n   * Incrementa el progreso actual\r\n   *\r\n   * @param amount - Cantidad a incrementar\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * loadingService.incrementProgress(10);\r\n   * ```\r\n   */\r\n  incrementProgress(amount: number): void {\r\n    const current = this.currentProgress();\r\n    if (current >= 0) {\r\n      this.setProgress(current + amount);\r\n    }\r\n  }\r\n\r\n  // =========================================================================\r\n  // MÉTODOS PÚBLICOS - LOADING LOCAL\r\n  // =========================================================================\r\n\r\n  /**\r\n   * Inicia loading local para un componente específico\r\n   *\r\n   * WORKFLOW:\r\n   * 1. Guarda estado en Map con ID\r\n   * 2. Emite cambio en Subject\r\n   * 3. Componente suscrito se actualiza\r\n   *\r\n   * @param id - Identificador único del componente\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * // En botón de guardar\r\n   * loadingService.startLocal('save-button');\r\n   * await save();\r\n   * loadingService.stopLocal('save-button');\r\n   * ```\r\n   */\r\n  startLocal(id: string): void {\r\n    this.localStates.set(id, true);\r\n    this.localStatesSubject.next(new Map(this.localStates));\r\n  }\r\n\r\n  /**\r\n   * Detiene loading local para un componente específico\r\n   *\r\n   * @param id - Identificador único del componente\r\n   */\r\n  stopLocal(id: string): void {\r\n    this.localStates.set(id, false);\r\n    this.localStatesSubject.next(new Map(this.localStates));\r\n  }\r\n\r\n  /**\r\n   * Verifica si un componente específico está en loading\r\n   *\r\n   * @param id - Identificador del componente\r\n   * @returns true si está cargando\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * if (loadingService.isLocalLoading('save-button')) {\r\n   *   return; // No hacer nada si ya está cargando\r\n   * }\r\n   * ```\r\n   */\r\n  isLocalLoading(id: string): boolean {\r\n    return this.localStates.get(id) ?? false;\r\n  }\r\n\r\n  /**\r\n   * Limpia el estado local de un componente\r\n   *\r\n   * @param id - Identificador del componente\r\n   */\r\n  clearLocal(id: string): void {\r\n    this.localStates.delete(id);\r\n    this.localStatesSubject.next(new Map(this.localStates));\r\n  }\r\n\r\n  // =========================================================================\r\n  // MÉTODOS DE CONVENIENCIA\r\n  // =========================================================================\r\n\r\n  /**\r\n   * Ejecuta una operación async con loading automático\r\n   *\r\n   * @param operation - Promesa a ejecutar\r\n   * @param message - Mensaje de carga\r\n   * @returns Resultado de la operación\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const albums = await loadingService.withLoading(\r\n   *   albumService.getAll(),\r\n   *   'Cargando álbumes...'\r\n   * );\r\n   * ```\r\n   */\r\n  async withLoading<T>(operation: Promise<T>, message?: string): Promise<T> {\r\n    this.start(message);\r\n    try {\r\n      return await operation;\r\n    } finally {\r\n      this.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Ejecuta una operación async con loading local automático\r\n   *\r\n   * @param id - Identificador del componente\r\n   * @param operation - Promesa a ejecutar\r\n   * @returns Resultado de la operación\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * await loadingService.withLocalLoading(\r\n   *   'save-button',\r\n   *   albumService.save(album)\r\n   * );\r\n   * ```\r\n   */\r\n  async withLocalLoading<T>(id: string, operation: Promise<T>): Promise<T> {\r\n    this.startLocal(id);\r\n    try {\r\n      return await operation;\r\n    } finally {\r\n      this.stopLocal(id);\r\n    }\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}

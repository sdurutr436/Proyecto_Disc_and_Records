<main class="search-results">
  <section class="search-results__search-section">
    <div class="search-results__search-wrapper">
      <button
        type="button"
        class="search-results__back-btn"
        (click)="goBack()"
        aria-label="Volver al inicio"
      >
        ‚Üê
      </button>
      <app-search-bar
        [placeholder]="'Buscar √°lbumes, artistas...'"
        [navigateOnSearch]="false"
        (onSearch)="newSearch($event)"
      />
    </div>
  </section>

  <header class="search-results__header">
    <div class="search-results__header-content">
      @if (searchTerm()) {
        <h1 class="search-results__title">
          Resultados para: <span class="search-results__query">"{{ searchTerm() }}"</span>
        </h1>
      } @else {
        <h1 class="search-results__title">
          Todos los <span class="search-results__query">√Ålbumes</span>
        </h1>
      }
      <p class="search-results__count">
        Mostrando {{ paginationInfo().showing }} de {{ paginationInfo().total }} resultados
      </p>
    </div>
  </header>

  <section class="search-results__tabs-section">
    <app-tabs
      [tabs]="tabs()"
      [activeTabId]="activeFilter()"
      (tabChange)="onTabChange($event)"
    />
  </section>

  @if (isLoading()) {
    <section class="search-results__loading" aria-busy="true">
      <app-spinner />
      <p>Buscando...</p>
    </section>
  }

  @if (!isLoading()) {
    @if (filteredResults().length > 0) {
      <section class="search-results__content" aria-label="Resultados de b√∫squeda">
        <div class="search-results__grid">
          @for (result of filteredResults(); track trackByResultId($index, result)) {
            <article class="search-results__item">
              <app-card
                [title]="result.title"
                [titleLink]="'/' + result.type + '/' + result.id"
                [subtitle]="result.subtitle || ''"
                [imageUrl]="result.imageUrl"
                [imageAlt]="result.title"
                [variant]="result.type === 'album' ? 'vinilo' : 'normal'"
                cardType="polaroid"
                hoverEffect="lift"
                (click)="viewResult(result)"
                class="search-results__card"
              >
                <div class="search-results__badge">
                  {{ getResultIcon(result.type) }} {{ getResultTypeLabel(result.type) }}
                </div>
                @if (result.fans) {
                  <div class="search-results__fans">
                    ‚ù§Ô∏è {{ result.fans | number }}
                  </div>
                }
              </app-card>
            </article>
          }
        </div>

        <app-infinite-scroll
          [loading]="isLoadingMore()"
          [hasMore]="hasMore()"
          (loadMore)="loadMoreResults()"
          loadingText="Cargando m√°s resultados..."
          endText="Has llegado al final de los resultados"
        />
      </section>
    }

    @if (filteredResults().length === 0 && searchTerm()) {
      <section class="search-results__empty" aria-label="Sin resultados">
        <div class="search-results__empty-icon">üîç</div>
        <h2 class="search-results__empty-title">No se encontraron resultados</h2>
        <p class="search-results__empty-text">
          No encontramos ning√∫n resultado para <strong>"{{ searchTerm() }}"</strong>
          @if (activeFilter() !== 'all') {
            <span> en la categor√≠a de <strong>{{ getResultTypeLabel(activeFilter()) }}s</strong></span>
          }
        </p>
        <p class="search-results__empty-suggestion">
          Intenta con otro t√©rmino de b√∫squeda o cambia el filtro
        </p>
      </section>
    }
  }
</main>

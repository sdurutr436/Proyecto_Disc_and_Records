<main class="search-results">
  <!-- ============================================ -->
  <!-- HEADER: TÃ©rmino de bÃºsqueda y botÃ³n volver   -->
  <!-- ============================================ -->
  <header class="search-results__header">
    <app-button
      variant="secondary"
      size="md"
      type="button"
      (click)="goBack()"
    >
      â† Volver
    </app-button>
    <div class="search-results__header-content">
      <h1 class="search-results__title">
        Resultados para: <span class="search-results__query">"{{ searchTerm() }}"</span>
      </h1>
      <p class="search-results__count">
        {{ filteredResults().length }} resultado{{ filteredResults().length !== 1 ? 's' : '' }} encontrado{{ filteredResults().length !== 1 ? 's' : '' }}
      </p>
    </div>
  </header>

  <!-- ============================================ -->
  <!-- BARRA DE BÃšSQUEDA INTEGRADA                  -->
  <!-- ============================================ -->
  <section class="search-results__search-bar">
    <app-search-bar
      (onSearch)="newSearch($event)"
    ></app-search-bar>
  </section>

  <!-- ============================================ -->
  <!-- FILTROS DE TIPO DE CONTENIDO                 -->
  <!-- ============================================ -->
  <nav class="search-results__filters">
    <app-button
      [variant]="isFilterActive('all') ? 'primary' : 'ghost'"
      type="button"
      [fullWidth]="true"
      (click)="setFilter('all')"
      [class.search-results__filter--active]="isFilterActive('all')"
      class="search-results__filter"
    >
      Todos <span class="search-results__filter-count">({{ resultsCount().all }})</span>
    </app-button>
    <app-button
      [variant]="isFilterActive('albums') ? 'primary' : 'ghost'"
      type="button"
      [fullWidth]="true"
      (click)="setFilter('albums')"
      [class.search-results__filter--active]="isFilterActive('albums')"
      class="search-results__filter"
    >
      ğŸ’¿ Ãlbumes <span class="search-results__filter-count">({{ resultsCount().albums }})</span>
    </app-button>
    <app-button
      [variant]="isFilterActive('artists') ? 'primary' : 'ghost'"
      type="button"
      [fullWidth]="true"
      (click)="setFilter('artists')"
      [class.search-results__filter--active]="isFilterActive('artists')"
      class="search-results__filter"
    >
      ğŸ¤ Artistas <span class="search-results__filter-count">({{ resultsCount().artists }})</span>
    </app-button>
    <app-button
      [variant]="isFilterActive('users') ? 'primary' : 'ghost'"
      type="button"
      [fullWidth]="true"
      (click)="setFilter('users')"
      [class.search-results__filter--active]="isFilterActive('users')"
      class="search-results__filter"
    >
      ğŸ‘¤ Usuarios <span class="search-results__filter-count">({{ resultsCount().users }})</span>
    </app-button>
    <app-button
      [variant]="isFilterActive('reviews') ? 'primary' : 'ghost'"
      type="button"
      [fullWidth]="true"
      (click)="setFilter('reviews')"
      [class.search-results__filter--active]="isFilterActive('reviews')"
      class="search-results__filter"
    >
      ğŸ“ ReseÃ±as <span class="search-results__filter-count">({{ resultsCount().reviews }})</span>
    </app-button>
  </nav>

  <!-- ============================================ -->
  <!-- LOADING STATE                                -->
  <!-- ============================================ -->
  @if (isLoading()) {
    <section class="search-results__loading">
      <app-spinner></app-spinner>
      <p>Buscando...</p>
    </section>
  }

  <!-- ============================================ -->
  <!-- RESULTADOS                                   -->
  <!-- ============================================ -->
  @if (!isLoading()) {
    @if (filteredResults().length > 0) {
      <section class="search-results__content">
        <div class="search-results__grid">
          @for (result of filteredResults(); track result.id) {
            <article class="search-results__item">
              <!-- Card para Ã¡lbumes y artistas -->
              @if (result.type === 'album' || result.type === 'artist') {
                <app-card
                  [title]="result.title"
                  [titleLink]="'/' + result.type + '/' + result.id"
                  [subtitle]="result.subtitle || ''"
                  [imageUrl]="result.imageUrl"
                  [imageAlt]="result.title"
                  [variant]="result.type === 'album' ? 'vinilo' : 'normal'"
                  cardType="polaroid"
                  hoverEffect="lift"
                  (click)="viewResult(result)"
                  class="search-results__card"
                >
                  <div class="search-results__badge">
                    {{ getResultIcon(result.type) }} {{ getResultTypeLabel(result.type) }}
                  </div>
                  @if (result.rating) {
                    <div class="search-results__rating">
                      <app-rating [rating]="result.rating" [showValue]="true" size="small" />
                    </div>
                  }
                </app-card>
              }

              <!-- Card especial para usuarios y reseÃ±as -->
              @if (result.type === 'user' || result.type === 'review') {
                <div class="search-results__custom-card" (click)="viewResult(result)">
                  <div class="search-results__custom-image">
                    <img [src]="result.imageUrl" [alt]="result.title" />
                  </div>
                  <div class="search-results__custom-content">
                    <div class="search-results__custom-badge">
                      {{ getResultIcon(result.type) }} {{ getResultTypeLabel(result.type) }}
                    </div>
                    <h3 class="search-results__custom-title">{{ result.title }}</h3>
                    @if (result.subtitle) {
                      <p class="search-results__custom-subtitle">{{ result.subtitle }}</p>
                    }
                    @if (result.description) {
                      <p class="search-results__custom-description">{{ result.description }}</p>
                    }
                    @if (result.rating) {
                      <div class="search-results__custom-rating">
                        <app-rating [rating]="result.rating!" size="medium" />
                      </div>
                    }
                  </div>
                </div>
              }
            </article>
          }
        </div>
      </section>
    }

    <!-- ============================================ -->
    <!-- NO RESULTS STATE                             -->
    <!-- ============================================ -->
    @if (filteredResults().length === 0) {
      <div class="search-results__empty">
        <div class="search-results__empty-icon">ğŸ”</div>
        <h2 class="search-results__empty-title">No se encontraron resultados</h2>
        <p class="search-results__empty-text">
          No encontramos ningÃºn resultado para <strong>"{{ searchTerm() }}"</strong>
          @if (activeFilter() !== 'all') {
            <span> en la categorÃ­a de <strong>{{ getResultTypeLabel(activeFilter()) }}s</strong></span>
          }
        </p>
        <p class="search-results__empty-suggestion">
          Intenta con otro tÃ©rmino de bÃºsqueda o cambia el filtro
        </p>
      </div>
    }
  }
</main>

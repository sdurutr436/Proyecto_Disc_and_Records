<main class="search-results">
  <nav class="search-results__search-section">
    <div class="search-results__search-wrapper">
      <app-button
        variant="secondary"
        size="md"
        (clicked)="goBack()"
        aria-label="Volver al inicio"
      >
        ←
      </app-button>
      <app-search-bar
        [placeholder]="'Buscar álbumes...'"
        [navigateOnSearch]="false"
        (onSearch)="newSearch($event)"
      />
    </div>
  </nav>

  <nav class="search-results__tabs-section">
    <app-tabs
      [tabs]="tabs()"
      [activeTabId]="activeFilter()"
      (tabChange)="onTabChange($event)"
    />
  </nav>

  @if (isLoading()) {
    <section class="search-results__loading" aria-busy="true">
      <app-spinner />
      <p>Buscando...</p>
    </section>
  }

  @if (!isLoading()) {
    @if (filteredResults().length > 0) {
      <section class="search-results__content" aria-label="Resultados de búsqueda">
        <div class="search-results__grid">
          @for (result of filteredResults(); track trackByResultId($index, result)) {
            <article class="search-results__item">
              <app-card
                [title]="result.title"
                [titleLink]="'/' + result.type + '/' + result.id"
                [subtitle]="result.subtitle || ''"
                [imageUrl]="result.imageUrl"
                [imageAlt]="result.title"
                [variant]="result.type === 'album' ? 'vinilo' : 'normal'"
                cardType="polaroid"
                hoverEffect="lift"
                (click)="viewResult(result)"
                class="search-results__card"
              >
                <div class="search-results__badge">
                  {{ getResultIcon(result.type) }} {{ getResultTypeLabel(result.type) }}
                </div>
              </app-card>
            </article>
          }
        </div>

        @if (rateLimitService.inCooldown()) {
          <div class="search-results__cooldown" role="alert">
            <lucide-icon name="clock" [size]="20"></lucide-icon>
            <span>{{ rateLimitService.statusMessage() }}</span>
          </div>
        }

        <app-infinite-scroll
          [loading]="isLoadingMore()"
          [hasMore]="hasMore()"
          (loadMore)="loadMoreResults()"
          loadingText="Cargando más resultados..."
          endText="Has llegado al final de los resultados"
        />
      </section>
    }

    @if (filteredResults().length === 0 && searchTerm()) {
      <section class="search-results__empty" aria-label="Sin resultados">
        <div class="search-results__empty-icon">
          <lucide-icon name="search" [size]="48"></lucide-icon>
        </div>
        <h2 class="search-results__empty-title">No se encontraron resultados</h2>
        <p class="search-results__empty-text">
          No encontramos ningún resultado para <strong>"{{ searchTerm() }}"</strong>
          @if (activeFilter() !== 'all') {
            <span> en la categoría de <strong>{{ getResultTypeLabel(activeFilter()) }}s</strong></span>
          }
        </p>
        <p class="search-results__empty-suggestion">
          Intenta con otro término de búsqueda o cambia el filtro
        </p>
      </section>
    }
  }
</main>

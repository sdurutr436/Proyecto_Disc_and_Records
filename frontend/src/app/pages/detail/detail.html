<div class="detail">
  @if (item(); as itemData) {
    <div class="detail__container">

      <!-- COLUMNA IZQUIERDA: INFO DEL √ÅLBUM (1/3) -->
      <aside class="detail__sidebar">
        <div class="detail-card">
          <!-- Cover del √°lbum -->
          <div class="detail-card__cover">
            <img
              [src]="itemData.coverUrl"
              [alt]="itemData.title"
              class="detail-card__image"
            />
          </div>

          <!-- Info b√°sica -->
          <div class="detail-card__info">
            <h1 class="detail-card__title">{{ itemData.title }}</h1>
            <p class="detail-card__artist" (click)="goToArtist(itemData.artistId)">
              {{ itemData.artist }}
            </p>

            <!-- Rating promedio -->
            <div class="detail-card__rating">
              <app-rating
                [rating]="itemData.averageRating"
                [showValue]="true"
                size="medium"
              />
              <p class="detail-card__reviews-count">
                {{ itemData.totalReviews }} rese√±as
              </p>
            </div>

            <!-- Detalles -->
            <div class="detail-card__details">
              <div class="detail-item">
                <span class="detail-item__label">A√±o</span>
                <span class="detail-item__value">{{ itemData.releaseYear }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-item__label">G√©nero</span>
                <span class="detail-item__value">{{ itemData.genre }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-item__label">Canciones</span>
                <span class="detail-item__value">{{ itemData.tracks }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-item__label">Duraci√≥n</span>
                <span class="detail-item__value">{{ itemData.duration }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-item__label">Sello</span>
                <span class="detail-item__value">{{ itemData.label }}</span>
              </div>
            </div>

            <!-- Descripci√≥n -->
            <div class="detail-card__description">
              <p>{{ itemData.description }}</p>
            </div>
          </div>
        </div>
      </aside>

      <!-- COLUMNA DERECHA: RESE√ëAS Y PUNTUACI√ìN (2/3) -->
      <main class="detail__content">

        <!-- Navegaci√≥n interna por secciones (usa fragments) -->
        <nav class="detail__nav">
          <app-button
            variant="ghost"
            size="md"
            (clicked)="navigateToSection('info')"
            class="detail__nav-item"
          >
            Informaci√≥n
          </app-button>
          <app-button
            variant="ghost"
            size="md"
            (clicked)="navigateToSection('tracks')"
            class="detail__nav-item"
          >
            Canciones
          </app-button>
          <app-button
            variant="ghost"
            size="md"
            (clicked)="navigateToSection('reviews')"
            class="detail__nav-item"
          >
            Rese√±as
          </app-button>
          <app-button
            variant="secondary"
            size="md"
            (clicked)="shareReviewsLink()"
            class="detail__nav-item detail__nav-item--share"
          >
            üîó Compartir
          </app-button>
        </nav>

        <!-- SECCI√ìN: LISTA DE CANCIONES -->
        <section id="tracks" class="tracklist-section">
          <h2 class="section-title">Lista de canciones</h2>
          <app-accordion
            [items]="tracklistAccordionItems()"
            mode="single">
          </app-accordion>
        </section>

        <!-- SECCI√ìN: TU PUNTUACI√ìN -->
        <section id="info" class="rating-section">
          <h2 class="section-title">Tu puntuaci√≥n</h2>

          <div class="rating-input">
            <div class="rating-input__stars">
              @for (star of [1, 2, 3, 4, 5]; track star) {
                <button
                  type="button"
                  class="star"
                  [class]="getStarClass(star)"
                  (click)="setRating(star)"
                  (mouseenter)="hoverStar(star)"
                  (mouseleave)="resetHover()"
                  [attr.aria-label]="'Puntuar con ' + star + ' estrellas'"
                >
                  ‚òÖ
                </button>
              }
            </div>

            @if (hasUserRated()) {
              <p class="rating-input__message">
                Has puntuado este √°lbum con {{ userRating() }} estrella{{ userRating() !== 1 ? 's' : '' }}
              </p>
            } @else {
              <p class="rating-input__message">
                Haz clic en una estrella para puntuar
              </p>
            }
          </div>
        </section>

        <!-- SECCI√ìN: ESCRIBIR RESE√ëA -->
        <section class="review-form-section">
          @if (!isWritingReview()) {
            <app-button
              variant="primary"
              size="lg"
              [fullWidth]="true"
              (clicked)="toggleReviewForm()"
            >
              Escribir una rese√±a
            </app-button>
          } @else {
            <div class="review-form">
              <h3 class="review-form__title">Escribe tu rese√±a</h3>

              <app-form-textarea
                [(ngModel)]="reviewText"
                placeholder="Comparte tu opini√≥n sobre este √°lbum (m√≠nimo 50 caracteres)..."
                [rows]="6"
              ></app-form-textarea>

              <div class="review-form__footer">
                <span class="review-form__counter">
                  {{ reviewText().length }} caracteres
                  @if (reviewText().length < 50) {
                    <span class="review-form__counter--warning">
                      (m√≠nimo 50)
                    </span>
                  }
                </span>

                <div class="review-form__actions">
                  <app-button
                    variant="secondary"
                    size="md"
                    (clicked)="cancelReview()"
                  >
                    Cancelar
                  </app-button>
                  <app-button
                    variant="primary"
                    size="md"
                    [disabled]="!canSubmitReview()"
                    (clicked)="submitReview()"
                  >
                    Publicar rese√±a
                  </app-button>
                </div>
              </div>
            </div>
          }
        </section>

        <!-- SECCI√ìN: LISTA DE RESE√ëAS -->
        <section id="reviews" class="reviews-section">
          <h2 class="section-title">
            Rese√±as de la comunidad
            <span class="section-title__count">({{ reviews().length }})</span>
          </h2>

          @if (isLoadingReviews()) {
            <div class="loading-state">
              <app-spinner></app-spinner>
              <app-alert
                type="info"
                message="Cargando rese√±as..."
              ></app-alert>
            </div>
          } @else if (reviews().length === 0) {
            <app-alert
              type="info"
              title="No hay rese√±as a√∫n"
              message="S√© el primero en compartir tu opini√≥n sobre este √°lbum"
            ></app-alert>
          } @else {
            <app-accordion
              [items]="reviewsAccordionItems()"
              mode="single">
            </app-accordion>
          }
        </section>

      </main>
    </div>
  } @else {
    <div class="loading-state loading-state--fullpage">
      <app-spinner></app-spinner>
      <app-alert
        type="info"
        message="Cargando √°lbum..."
      ></app-alert>
    </div>
  }
</div>

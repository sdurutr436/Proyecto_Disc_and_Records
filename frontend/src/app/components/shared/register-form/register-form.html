<form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form" method="post" novalidate>
  <!-- Fieldset 1: Información de cuenta -->
  <fieldset class="register-form__fieldset">
    <legend class="register-form__legend">Crea tu cuenta</legend>

    <!-- Campo de nombre de usuario -->
    <div class="register-form__field">
      <label for="register-username" class="register-form__label">
        Nombre de usuario
        <span class="register-form__required" aria-label="Campo requerido">*</span>
      </label>
      <input
        id="register-username"
        type="text"
        [formControl]="registerForm.get('username')"
        placeholder="tunombredeusuario"
        class="register-form__input"
        [class.register-form__input--error]="registerForm.get('username')?.invalid && registerForm.get('username')?.touched"
        [attr.aria-invalid]="registerForm.get('username')?.invalid && registerForm.get('username')?.touched"
        [attr.aria-describedby]="(registerForm.get('username')?.invalid && registerForm.get('username')?.touched) ? 'username-error' : 'username-help'"
        autocomplete="username" />

      <!-- Mensaje de error -->
      @if (registerForm.get('username')?.invalid && registerForm.get('username')?.touched) {
      <p
        id="username-error"
        class="register-form__error"
        role="alert">
        @if (registerForm.get('username')?.hasError('required')) {
          Username es requerido
        }
        @if (registerForm.get('username')?.hasError('minlength')) {
          Mínimo 3 caracteres
        }
        @if (registerForm.get('username')?.hasError('maxlength')) {
          Máximo 20 caracteres
        }
        @if (registerForm.get('username')?.hasError('pattern')) {
          Solo letras, números y guiones bajos
        }
      </p>
      }

      <!-- Texto de ayuda -->
      @if (!registerForm.get('username')?.invalid || !registerForm.get('username')?.touched) {
      <p
        id="username-help"
        class="register-form__help">
        Este será tu nombre visible en Discs & Records
      </p>
      }
    </div>

    <!-- Campo de correo electrónico -->
    <div class="register-form__field">
      <label for="register-email" class="register-form__label">
        Correo electrónico
        <span class="register-form__required" aria-label="Campo requerido">*</span>
      </label>
      <input
        id="register-email"
        type="email"
        [formControl]="registerForm.get('email')"
        placeholder="tu@email.com"
        class="register-form__input"
        [class.register-form__input--error]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
        [attr.aria-invalid]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
        [attr.aria-describedby]="(registerForm.get('email')?.invalid && registerForm.get('email')?.touched) ? 'email-error' : 'email-help'"
        autocomplete="email" />

      <!-- Mensaje de error -->
      @if (registerForm.get('email')?.invalid && registerForm.get('email')?.touched) {
      <p
        id="email-error"
        class="register-form__error"
        role="alert">
        @if (registerForm.get('email')?.hasError('required')) {
          Email es requerido
        }
        @if (registerForm.get('email')?.hasError('email')) {
          Email debe ser válido
        }
      </p>
      }

      <!-- Texto de ayuda -->
      @if (!registerForm.get('email')?.invalid || !registerForm.get('email')?.touched) {
      <p
        id="email-help"
        class="register-form__help">
        Lo usaremos para enviarte actualizaciones de tus álbumes favoritos
      </p>
      }
    </div>
  </fieldset>

  <!-- Fieldset 2: Seguridad -->
  <fieldset class="register-form__fieldset">
    <legend class="register-form__legend">Seguridad</legend>

    <!-- Campo de contraseña -->
    <div class="register-form__field">
      <label for="register-password" class="register-form__label">
        Contraseña
        <span class="register-form__required" aria-label="Campo requerido">*</span>
      </label>
      <input
        id="register-password"
        type="password"
        [formControl]="registerForm.get('password')"
        placeholder="••••••••"
        class="register-form__input"
        [class.register-form__input--error]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched"
        [attr.aria-invalid]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched"
        [attr.aria-describedby]="(registerForm.get('password')?.invalid && registerForm.get('password')?.touched) ? 'password-error' : 'password-help'"
        autocomplete="new-password" />

      <!-- Mensaje de error -->
      @if (registerForm.get('password')?.invalid && registerForm.get('password')?.touched) {
      <span
        id="password-error"
        class="register-form__error"
        role="alert">
        @if (registerForm.get('password')?.hasError('required')) {
          Contraseña es requerida
        }
        @if (registerForm.get('password')?.hasError('minlength')) {
          Mínimo 8 caracteres
        }
        @if (registerForm.get('password')?.hasError('pattern')) {
          Debe contener mayúscula y carácter especial (!@#$%...)
        }
      </span>
      }

      <!-- Texto de ayuda -->
      @if (!registerForm.get('password')?.invalid || !registerForm.get('password')?.touched) {
      <span
        id="password-help"
        class="register-form__help">
        Mínimo 8 caracteres para proteger tu cuenta
      </span>
      }
    </div>

    <!-- Campo de confirmación de contraseña -->
    <div class="register-form__field">
      <label for="register-confirm-password" class="register-form__label">
        Confirmar contraseña
        <span class="register-form__required" aria-label="Campo requerido">*</span>
      </label>
      <input
        id="register-confirm-password"
        type="password"
        [formControl]="registerForm.get('confirmPassword')"
        placeholder="••••••••"
        class="register-form__input"
        [class.register-form__input--error]="(registerForm.get('confirmPassword')?.invalid || registerForm.hasError('passwordMismatch')) && registerForm.get('confirmPassword')?.touched"
        [attr.aria-invalid]="(registerForm.get('confirmPassword')?.invalid || registerForm.hasError('passwordMismatch')) && registerForm.get('confirmPassword')?.touched"
        [attr.aria-describedby]="((registerForm.get('confirmPassword')?.invalid || registerForm.hasError('passwordMismatch')) && registerForm.get('confirmPassword')?.touched) ? 'confirm-password-error' : 'confirm-password-help'"
        autocomplete="new-password" />

      <!-- Mensaje de error -->
      @if ((registerForm.get('confirmPassword')?.invalid || registerForm.hasError('passwordMismatch')) && registerForm.get('confirmPassword')?.touched) {
      <span
        id="confirm-password-error"
        class="register-form__error"
        role="alert">
        @if (registerForm.get('confirmPassword')?.hasError('required')) {
          Confirma tu contraseña
        }
        @if (registerForm.hasError('passwordMismatch')) {
          Las contraseñas no coinciden
        }
      </span>
      }

      <!-- Texto de ayuda -->
      @if ((!registerForm.get('confirmPassword')?.invalid && !registerForm.hasError('passwordMismatch')) || !registerForm.get('confirmPassword')?.touched) {
      <span
        id="confirm-password-help"
        class="register-form__help">
        Vuelve a escribir tu contraseña
      </span>
      }
    </div>
  </fieldset>

  <!-- Botón de submit -->
  <button
    type="submit"
    class="register-form__submit"
    [disabled]="registerForm.invalid || isSubmitting()"
    [attr.aria-busy]="isSubmitting()">
    {{ isSubmitting() ? 'CREANDO CUENTA...' : 'CREAR CUENTA' }}
  </button>

  <!-- Link de inicio de sesión -->
  <div class="register-form__footer">
    <p class="register-form__footer-text">
      ¿Ya tienes cuenta? 
      <a href="#" class="register-form__link">Inicia sesión</a>
    </p>
  </div>
</form>

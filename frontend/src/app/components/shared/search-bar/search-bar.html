<div class="search-bar">
  <div class="search-bar__container">
    <!-- Label visible para accesibilidad -->
    <label for="search-input" class="search-bar__label">Buscar en la colección</label>

    <!-- Input de búsqueda -->
    <input
      id="search-input"
      type="text"
      class="search-bar__input"
      [value]="searchTerm()"
      (input)="updateSearchTerm($any($event.target).value)"
      (keypress)="handleKeyPress($event)"
      [placeholder]="placeholder"
      [attr.aria-busy]="isSearching()"
    />

    <!-- Spinner de carga (visible durante búsqueda) -->
    @if (isSearching()) {
      <div class="search-bar__loading">
        <app-spinner [size]="'sm'"></app-spinner>
      </div>
    }

    <!-- Botón de limpiar (solo visible si hay texto y no está buscando) -->
    @if (searchTerm() && !isSearching()) {
      <button
        type="button"
        class="search-bar__clear"
        (click)="clearSearch()"
        aria-label="Limpiar búsqueda"
      >
        <lucide-icon [img]="X" [size]="16" *ngIf="X; else fallbackX"></lucide-icon>
        <ng-template #fallbackX>✕</ng-template>
      </button>
    }

    <!-- Botón de búsqueda -->
    <button
      type="button"
      class="search-bar__button"
      (click)="handleSearch()"
      [disabled]="!searchTerm().trim() || isSearching()"
      aria-label="Buscar"
    >
      <!-- Icono de lupa -->
      <svg class="search-bar__icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
    </button>
  </div>
</div>

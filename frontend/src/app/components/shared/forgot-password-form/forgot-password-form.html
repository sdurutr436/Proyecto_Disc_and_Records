<!-- Vista cuando NO se ha enviado el email -->
<form
  *ngIf="!emailSent()"
  [formGroup]="forgotForm"
  class="forgot-password-form"
  (ngSubmit)="onSubmit()"
  method="post"
  novalidate>

  <fieldset class="forgot-password-form__fieldset">
    <legend class="forgot-password-form__legend">Recupera tu contraseña</legend>

    <!-- Descripción -->
    <p class="forgot-password-form__description">
      Introduce tu correo electrónico y te enviaremos un enlace para restablecer tu contraseña.
    </p>

    <!-- Campo de correo electrónico - Componente Atómico -->
    <div class="forgot-password-form__field">
      <app-form-input
        [control]="emailControl"
        label="Correo electrónico"
        type="email"
        id="forgot-email"
        placeholder="tu@email.com"
        helpText="Usa el mismo correo con el que te registraste"
        [required]="true"
        [autocomplete]="'email'">
      </app-form-input>
    </div>
  </fieldset>

  <!-- Botón de submit -->
  <button
    type="submit"
    class="forgot-password-form__submit"
    [disabled]="forgotForm.invalid || isSubmitting()"
    [attr.aria-busy]="isSubmitting()">
    {{ isSubmitting() ? 'ENVIANDO...' : 'ENVIAR ENLACE' }}
  </button>

  <!-- Link de volver al login -->
  <div class="forgot-password-form__footer">
    <button
      type="button"
      class="forgot-password-form__link-btn"
      (click)="onBackToLogin.emit()">
      ← Volver al inicio de sesión
    </button>
  </div>
</form>

<!-- Vista de confirmación cuando se ha enviado el email -->
<div *ngIf="emailSent()" class="forgot-password-form forgot-password-form--success">
  <div class="forgot-password-form__success-content">
    <!-- Icono de éxito -->
    <div class="forgot-password-form__success-icon" aria-hidden="true">✓</div>

    <!-- Título -->
    <h2 class="forgot-password-form__success-title">
      ¡Revisa tu correo!
    </h2>

    <!-- Mensaje -->
    <p class="forgot-password-form__success-message">
      Hemos enviado un enlace de recuperación a <strong>{{ forgotForm.get('email')?.value }}</strong>
    </p>

    <p class="forgot-password-form__success-info">
      El enlace expirará en 1 hora. Si no recibes el correo, revisa tu carpeta de spam.
    </p>

    <!-- Botón para enviar otro correo -->
    <button
      type="button"
      class="forgot-password-form__submit forgot-password-form__submit--secondary"
      (click)="sendAnother()">
      ENVIAR OTRO CORREO
    </button>

    <!-- Link de volver al login -->
    <div class="forgot-password-form__footer">
      <button
        type="button"
        class="forgot-password-form__link-btn"
        (click)="onBackToLogin.emit()">
        ← Volver al inicio de sesión
      </button>
    </div>
  </div>
</div>

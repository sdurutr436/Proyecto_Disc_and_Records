<!-- Parte superior del header (logo y botones) - se va con scroll -->
<header class="header">
  <div class="header__top">
    <div class="header__top-container">
      <!-- Barras de colores FUERA del logo-wrapper -->
      <div class="header__stripes" aria-hidden="true"></div>

      <!-- Logo central - clickeable para ir al home -->
      <button
        class="header__logo-wrapper"
        (click)="navigateToHome()"
        type="button"
        aria-label="Ir a la página principal">
        <img
          src="/assets/logo.webp"
          srcset="/assets/logo-128.webp 1x, /assets/logo-256.webp 2x"
          alt="Discs & Records"
          class="header__logo"
          width="128"
          height="128"
          fetchpriority="high" />
      </button>

      <!-- Botones debajo del logo -->
      <div class="header__buttons">
        @if (appState.isAuthenticated()) {
          <!-- Usuario autenticado: mostrar perfil y cerrar sesión -->
          <button
            class="header__btn header__btn--left"
            (click)="navigateToProfile()"
            type="button">
            MI PERFIL
          </button>
          <button
            class="header__btn header__btn--right"
            (click)="logout()"
            type="button">
            CERRAR SESIÓN
          </button>
        } @else {
          <!-- Usuario no autenticado: mostrar registro e inicio de sesión -->
          <button
            class="header__btn header__btn--left"
            (click)="openRegisterModal()"
            type="button">
            REGISTRARSE
          </button>
          <button
            class="header__btn header__btn--right"
            (click)="openLoginModal()"
            type="button">
            INICIAR SESIÓN
          </button>
        }
      </div>
    </div>
  </div>
</header>

<!-- ========================================
     MODALES DE AUTENTICACIÓN
     ======================================== -->

<!-- Modal de Login - Lazy loaded con @defer -->
<app-modal
  [isOpen]="activeModal() === 'login'"
  (onClose)="closeAuthModal()">
  @defer (when activeModal() === 'login') {
    <app-login-form
      (onForgotPassword)="navigateToModal('forgot-password')"
      (onRegister)="navigateToModal('register')"
      (onLoginSuccess)="closeAuthModal()">
    </app-login-form>
  } @loading {
    <div class="modal-loading">
      <span class="modal-loading__spinner"></span>
      <span>Cargando...</span>
    </div>
  }
</app-modal>

<!-- Modal de Registro - Lazy loaded con @defer -->
<app-modal
  [isOpen]="activeModal() === 'register'"
  (onClose)="closeAuthModal()">
  @defer (when activeModal() === 'register') {
    <app-register-form
      (onLogin)="navigateToModal('login')"
      (onRegisterSuccess)="closeAuthModal()">
    </app-register-form>
  } @loading {
    <div class="modal-loading">
      <span class="modal-loading__spinner"></span>
      <span>Cargando...</span>
    </div>
  }
</app-modal>

<!-- Modal de Recuperar Contraseña - Lazy loaded con @defer -->
<app-modal
  [isOpen]="activeModal() === 'forgot-password'"
  (onClose)="closeAuthModal()">
  @defer (when activeModal() === 'forgot-password') {
    <app-forgot-password-form
      (onBackToLogin)="navigateToModal('login')">
    </app-forgot-password-form>
  } @loading {
    <div class="modal-loading">
      <span class="modal-loading__spinner"></span>
      <span>Cargando...</span>
    </div>
  }
</app-modal>
